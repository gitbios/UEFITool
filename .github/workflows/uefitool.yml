name: UEFITool

on: 
  push:

jobs:
  build:
    runs-on: windows-2016

    steps:
    - uses: actions/checkout@v2

    - name: Get Qt
      uses: actions/checkout@v2
      with:
        repository: LongSoft/qt-5.6.3-static-x86-msvc2017
        path: qt
        lfs: true

    - name: Unpack Qt
      shell: bash
      working-directory: qt
      run: 7z x qt-5.6.3-static-x86-msvc2017.zip -o..

    - name: Create Build Environment
      run: cmake -E make_directory ${{runner.workspace}}/build/UEFITool

    - name: Qmake
      shell: bash
      working-directory: ${{runner.workspace}}/build/UEFITool
      run: $GITHUB_WORKSPACE/qt-5.6.3-static-x86-msvc2017/bin/qmake.exe ${{runner.workspace}}/UEFITool/UEFITool.pro

    - name: Build
      working-directory: ${{runner.workspace}}/build/UEFITool
      shell: cmd
      run: | 
          call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\VC\Auxiliary\Build\vcvars32.bat"
          nmake release


