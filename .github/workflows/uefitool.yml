name: UEFITool

on: 
  push:

jobs:
  build:
    runs-on: windows-2016

    steps:
    - uses: actions/checkout@v2

    - name: Get Qt
      uses: actions/checkout@v2
      with:
        repository: LongSoft/qt-5.6.3-static-x86-msvc2017
        path: qt
        lfs: true

    - name: Unpack Qt
      shell: bash
      working-directory: qt
      run: 7z x qt-5.6.3-static-x86-msvc2017.7z -o../..

    - name: Create Build Directory
      run: cmake -E make_directory ${{runner.workspace}}/build/UEFITool

    - name: Qmake
      shell: bash
      working-directory: ${{runner.workspace}}/build/UEFITool
      run: ../../qt-5.6.3-static-x86-msvc2017/bin/qmake.exe ../../UEFITool/UEFITool/
  
    - name: Upload Makefile
      uses: actions/upload-artifact@v2
      with:
        name: Makefile.release
        path: ${{runner.workspace}}/build/UEFITool/Makefile.release

    - name: Build
      working-directory: ${{runner.workspace}}/build/UEFITool
      shell: cmd
      run: | 
          call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\VC\Auxiliary\Build\vcvars32.bat"
          nmake release

    - name: Upload
      uses: actions/upload-artifact@v2
      with:
        name: UEFITool_win32
        path: ${{runner.workspace}}/build/UEFITool/release/UEFITool.exe
